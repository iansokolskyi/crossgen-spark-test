#!/bin/sh

# Exit immediately if any command fails
set -e

REPO_ROOT=$(git rev-parse --show-toplevel)

echo "ğŸ” Running pre-commit checks..."

# Check Plugin
echo "\nğŸ“¦ Checking Plugin..."
cd "$REPO_ROOT/plugin"

# Auto-fix formatting and linting
echo "  Formatting..."
npm run format

echo "  Linting..."
npm run lint:fix

# Run full check (format:check, lint, type-check)
echo "  Running checks..."
npm run check

echo "âœ… Plugin checks passed!"

# Check Daemon
echo "\nğŸ¤– Checking Daemon..."
cd "$REPO_ROOT/daemon"

# Auto-fix formatting and linting
echo "  Formatting..."
npm run format

echo "  Linting..."
npm run lint:fix

# Run full check (format:check, lint, type-check, tests)
echo "  Running checks..."
npm run check

echo "âœ… Daemon checks passed!"

# Add any auto-fixed files
cd "$REPO_ROOT"
git add -u

echo "\nâœ… All pre-commit checks passed!"
echo "ğŸš€ Proceeding with commit..."

